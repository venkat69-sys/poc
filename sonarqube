echo "Installing the Sonarqube..."
echo "Install postgresql&java"
sudo yum install postgresql-server -y
sudo postgresql-setup --initdb
sudo systemctl enable --now postgresql
echo "Create database"
sudo -u postgres psql
CREATE DATABASE sonarqube;
CREATE USER sonar WITH ENCRYPTED PASSWORD 'sonarqube';
GRANT ALL PRIVILEGES ON DATABASE sonarqube TO sonar;
echo "Download the soanrqube"
cd /opt
wget https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-9.9.7.96285.zip
unzip sonarqube-9.9.7.96285.zip
mv sonarqube-9.9.7.96285 sonarqube
echo "Configure SonarQube"

echo "sonar.jdbc.username=sonar;sonar.jdbc.password=sonarqube;sonar.jdbc.url=jdbc:postgresql://localhost/sonarqube" >> /opt/sonarqube/conf/sonar.properties
 
echo "Sonar user and start service"
sudo useradd sonar
sudo chown -R sonar:sonar /opt/sonarqube
sudo su - sonar
cd /opt/sonarqube/bin/linux-x86-64;sh sonar.sh start

echo "Completed the Soanrqube installation"

